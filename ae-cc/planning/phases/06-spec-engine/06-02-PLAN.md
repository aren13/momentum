# Plan 06-02: Spec Generation with Critic Review

**Phase:** 6 - Enhanced Specification Engine
**Plan:** 06-02
**Created:** 2025-12-18
**Status:** Pending

---

## Objective

Implement specification generation with self-critique capabilities to produce high-quality, comprehensive specifications that catch ambiguities and edge cases before implementation begins.

---

## Context

This plan implements the second half of Phase 6's Enhanced Specification Engine. Building on the discovery and requirements from Plan 06-01, this plan adds multi-step spec generation with AI-powered self-critique to identify gaps, ambiguities, and missing edge cases.

---

## Tasks

### Task 1: Create SpecGenerator Class

**File:** `momentum/lib/core/spec-generator.js`

**Implementation:**
- `generate(requirements, context)` - Generate initial spec
  - Use requirements from discovery phase
  - Incorporate discovered context
  - Follow spec template structure
  - Generate comprehensive specification sections
- `critique(spec)` - Self-critique for gaps and issues
  - Check for ambiguities
  - Identify missing edge cases
  - Verify completeness
  - Flag unclear requirements
- `refine(spec, critique)` - Improve spec based on critique
  - Address identified issues
  - Add missing details
  - Clarify ambiguous sections
  - Enhance edge case coverage
- `finalize(spec)` - Output final SPEC.md
  - Format according to template
  - Add metadata (created date, version, etc.)
  - Write to phase directory

**Dependencies:** None

**Verification:**
```bash
# File exists and exports SpecGenerator class
node -e "const SG = require('./momentum/lib/core/spec-generator.js'); console.log(typeof SG.generate)"
```

---

### Task 2: Create SpecCritic Class

**File:** `momentum/lib/core/spec-critic.js`

**Implementation:**
- Check for ambiguities
  - Identify vague language
  - Flag undefined terms
  - Detect inconsistencies
- Verify completeness
  - Check all required sections present
  - Ensure success criteria defined
  - Verify dependencies listed
- Identify edge cases
  - Boundary conditions
  - Error scenarios
  - Integration points
  - Performance considerations
- Score confidence
  - Rate spec quality (0-100)
  - Provide confidence breakdown by section
  - Suggest improvements

**Dependencies:** None

**Verification:**
```bash
# File exists and exports SpecCritic class
node -e "const SC = require('./momentum/lib/core/spec-critic.js'); console.log(typeof SC.critique)"
```

---

### Task 3: Create Spec Templates

**File:** `momentum/templates/spec.md`

**Implementation:**

Standard spec format with sections:
- **Overview** - High-level description of the feature
- **Requirements** - Functional and non-functional requirements
  - Functional Requirements
  - Non-Functional Requirements
  - Constraints
  - Assumptions
- **Edge Cases** - Boundary conditions and error scenarios
- **Dependencies** - External and internal dependencies
- **Success Criteria** - How to verify implementation is complete
- **Technical Design** (optional) - Architecture notes
- **Implementation Notes** (optional) - Guidance for developers

Template should include comments/examples for each section.

**Dependencies:** None

**Verification:**
```bash
# Template file exists
test -f momentum/templates/spec.md && echo "Template exists"
```

---

### Task 4: Add Spec Generation Command

**File:** `momentum/lib/commands/spec.js` (update)

**Implementation:**
- Add `generate` subcommand
  - `momentum spec generate` - Full spec workflow
  - Read DISCOVERY.md if exists
  - Generate initial spec
  - Run critique pass
  - Refine based on critique
  - Show confidence score
- Allow manual review before finalize
  - Display spec preview
  - Show critique results
  - Prompt for approval or additional refinement
- Output to phase directory as SPEC.md
  - Default location: current phase directory
  - Allow custom output path with `--output` flag

**Integration:**
- Update command in `momentum/lib/cli.js`
- Add to help documentation
- Wire up SpecGenerator and SpecCritic classes
- Integrate with discovery output from Plan 06-01

**Dependencies:** Tasks 1, 2, 3

**Verification:**
```bash
# Command is registered
momentum spec generate --help
```

---

## Success Criteria

- [x] SpecGenerator class created with all four methods
- [x] SpecCritic class created with critique capabilities
- [x] Spec template created with all required sections
- [x] `momentum spec generate` command works end-to-end
- [x] Generated specs follow template structure
- [x] Critique identifies ambiguities and gaps
- [x] Refinement improves spec quality
- [x] Confidence scoring provides actionable feedback
- [x] SPEC.md output is properly formatted
- [x] All verification commands pass

---

## Dependencies

**Upstream:** Plan 06-01 (provides discovery and requirements)

**Downstream:** Phase planning (specs inform plan creation)

---

## Notes

- Critique should be substantive, not just template checks
- Multiple critique/refine iterations may be needed for complex features
- Consider adding `--iterations` flag to control critique passes
- Confidence scoring should guide whether spec needs more work
- Integration with existing planning workflow (specs â†’ plans) is key

---

## Execution Log

*Execution details will be recorded here when this plan is run.*
