# Plan 03-02: Advanced AI-Powered Fix Strategies

**Phase:** 3 - QA Loop
**Plan:** 03-02
**Status:** In Progress

## Objective

Implement advanced fix strategies that use AI to analyze and fix complex issues that simple auto-fix cannot handle. This builds on the basic QARunner from Plan 03-01 by adding intelligent error analysis and context-aware fixes.

## Context

- Plan 03-01 implemented basic QARunner with lint/typecheck/test/build checks
- Simple auto-fix handles straightforward issues (formatting, missing semicolons)
- Complex issues (type errors, test failures, import issues) need AI analysis

## Tasks

### 1. Create FixStrategy Class
**File:** `momentum/lib/core/fix-strategy.js`

Implement intelligent fix strategy system:
- `analyzeError(error, context)` - Parse error and identify fix approach
- `generateFix(analysis)` - Create fix using AI prompt
- `applyFix(fix)` - Apply the generated fix
- `verifyFix()` - Check if fix worked

**Strategies to implement:**
- `lint-fix` - ESLint errors
- `type-fix` - TypeScript/JSDoc type errors
- `test-fix` - Test failures
- `import-fix` - Import/module resolution issues
- `syntax-fix` - Syntax errors

**Success Criteria:**
- [ ] FixStrategy class with all core methods
- [ ] Each strategy type implemented
- [ ] Error analysis identifies correct strategy
- [ ] Fixes can be applied and verified

### 2. Create AI Prompt Templates
**File:** `momentum/lib/core/fix-prompts.js`

Build error-specific prompt templates:
- Error-specific prompt templates for each strategy type
- Context gathering for fixes (surrounding code, imports, dependencies)
- Fix validation criteria
- Prompt structure that ensures actionable fixes

**Success Criteria:**
- [ ] Prompt templates for each fix strategy
- [ ] Context gathering utilities
- [ ] Validation criteria included in prompts
- [ ] Prompts produce parseable fix instructions

### 3. Integrate with QARunner
**File:** `momentum/lib/core/qa-runner.js` (modify)

Connect FixStrategy to existing QARunner:
- Use FixStrategy when simple fix fails
- Track fix success rates
- Learn from successful fixes (optional: store patterns)
- Provide feedback on fix attempts

**Success Criteria:**
- [ ] QARunner calls FixStrategy for complex errors
- [ ] Fix attempts are tracked
- [ ] Success rates recorded
- [ ] Graceful fallback if AI fix fails

### 4. Add Fix Statistics to QA Report
**File:** `momentum/lib/core/qa-runner.js` (modify)

Enhanced reporting:
- Show which strategies were tried
- Success/failure rates per strategy
- Time spent on fixes
- Summary of what was fixed vs. what remains

**Success Criteria:**
- [ ] Fix statistics in QA report output
- [ ] Strategy-level success metrics
- [ ] Timing information
- [ ] Clear summary of fix results

## Implementation Order

1. Create `fix-strategy.js` with core FixStrategy class
2. Create `fix-prompts.js` with all prompt templates
3. Integrate FixStrategy into QARunner
4. Add fix statistics to QA report

## Verification

After implementation:
1. Run QA checks on a project with known issues
2. Verify FixStrategy attempts to fix complex errors
3. Check that fix statistics appear in report
4. Confirm fixes are actually applied and verified

## Dependencies

- Plan 03-01 (QARunner implementation)
- AI/LLM integration for generating fixes
- File system operations for applying fixes

## Notes

- Start with simple fix strategies (lint, syntax) before complex ones (test, type)
- Ensure fixes are idempotent (can be safely retried)
- Consider adding a dry-run mode for testing fixes
- Track fix patterns for future optimization
